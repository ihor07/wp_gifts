function _createForOfIteratorHelper(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==o.return||o.return()}finally{if(c)throw i}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,r=new Array(e);o<e;o++)r[o]=t[o];return r}import{WCPW}from"wcpw";import{WCPWVariationForm}from"wcpw-variation-form";import{Masonry}from"masonry-layout";import{jQuery as $}from"jquery";var wcpw={windowNode:window,documentNode:document,$window:void 0!==$?$(window):null,$document:void 0!==$?$(document):null,$body:void 0!==$?$(document.body):null,stickyObserverElements:null,init:function(){if(void 0===WCPW)return this.windowNode.console.error("WCPW class is not exist"),this;var t,e=_createForOfIteratorHelper(this.documentNode.querySelectorAll('[data-component~="wcpw"]'));try{for(e.s();!(t=e.n()).done;){var o=t.value;o.wcpw=new WCPW(o,JSON.parse(o.getAttribute("data-options"))||{}),o.wcpw.init()}}catch(t){e.e(t)}finally{e.f()}return this},initVariationForm:function(t){if(void 0===WCPWVariationForm)return this.windowNode.console.error("WCPWVariationForm class is not exist"),this;var e,o=_createForOfIteratorHelper(t=t||this.documentNode.querySelectorAll('[data-component~="wcpw-product-variations"]'));try{for(o.s();!(e=o.n()).done;){var r=e.value;r.wcpwVariationForm=new WCPWVariationForm(r,JSON.parse(r.getAttribute("data-options"))||{}),r.wcpwVariationForm.init()}}catch(t){o.e(t)}finally{o.f()}return this},onInit:function(t){var e=t.detail.instance;if(this.initVariationForm(e.element.querySelectorAll('[data-component~="wcpw-product-variations"]')),this.$document&&e.options&&e.options.attachedProduct&&this.$document.find("#"+e.options.formId).trigger("check_variations"),void 0!==$&&void 0!==$.fn.prettyPhoto&&$(e.element).find('a[data-rel^="prettyPhoto"]').prettyPhoto({hook:"data-rel",social_tools:!1,theme:"pp_woocommerce",horizontal_padding:20,opacity:.8,deeplinking:!1}),void 0!==this.windowNode.avadaLightBox&&void 0!==this.windowNode.avadaLightBox.activate_lightbox&&this.windowNode.avadaLightBox.activate_lightbox($(e.element)),void 0!==$&&void 0!==$.fn.stick_in_parent){var o,r=_createForOfIteratorHelper(e.element.querySelectorAll('[data-component~="wcpw-sticky"]'));try{for(r.s();!(o=r.n()).done;){var n=o.value;$(n).stick_in_parent(Object.assign({parent:n.getAttribute("data-sticky-parent"),offset_top:Number(n.getAttribute("data-sticky-top-offset"))},JSON.parse(n.getAttribute("data-sticky-options")||"{}")))}}catch(t){r.e(t)}finally{r.f()}}if(this.reInitExtraProductOptions(e),this.documentNode.dispatchEvent(new CustomEvent("init.nouislider.wcpw")),this.documentNode.dispatchEvent(new CustomEvent("init.wcsf")),void 0!==Masonry){var i,a=_createForOfIteratorHelper(e.element.querySelectorAll('[data-component~="wcpw-masonry"]'));try{for(a.s();!(i=a.n()).done;){var c=i.value;c.masonryInstance=new Masonry(c,Object.assign({itemSelector:".col",percentPosition:!0,columnWidth:c.querySelector('[data-component="wcpw-masonry-sizer"]')},JSON.parse(c.getAttribute("data-options")||"{}")))}}catch(t){a.e(t)}finally{a.f()}}},reInitExtraProductOptions:function(t){if(void 0!==$&&void 0!==$.tcepo&&void 0!==$.tcepo.tm_init_epo){void 0!==$.tc_api_set?$.tc_api_set("get_element_from_field_cache",[]):void 0!==$.tcAPISet&&$.tcAPISet("getElementFromFieldCache",[]),this.$document.off("change.cpfurl tmredirect",".use_url_container .tmcp-select"),this.$document.off("click.cpfurl change.cpfurl tmredirect",".use_url_container .tmcp-radio, .use_url_container .tmcp-radio+label"),t.element.querySelectorAll(".tmcp-upload-hidden").remove();var e,o=_createForOfIteratorHelper(t.element.querySelectorAll('[data-component~="wcpw-product"]'));try{for(o.s();!(e=o.n()).done;){var r=e.value,n=$(r),i=r.querySelector(".tc-extra-product-options"),a=i.getAttribute("data-product-id"),c=i.getAttribute("data-epo-id");i&&a&&c&&($.tcepo.tm_init_epo(n,!0,a,c),this.$window.trigger("tmlazy"),$.jMaskGlobals&&n.find($.jMaskGlobals.maskElements).each((function(){var t=$(this);t.attr("data-mask")&&t.mask(t.attr("data-mask"))})),"variable"===r.getAttribute("data-type")&&n.find('[data-component~="wcpw-product-variations"]').trigger("wc_variation_form.cpf"))}}catch(t){o.e(t)}finally{o.f()}}},saveExtraProductOptions:function(t){if(void 0===$||void 0===$.tcepo)return null;var e=t.product_id,o=this.$document.find(".tc-extra-product-options.tm-product-id-".concat(e));if(1!==o.length)return!0;var r=this.$document.find(".tc-totals-form.tm-product-id-".concat(e)),n=r.closest("form"),i=r.find(".tc_form_prefix").val(),a={tcajax:1,tcaddtocart:e,cpf_product_price:r.find(".cpf-product-price").val()};if(i&&(a.tc_form_prefix=i),r.tc_validate&&!n.tc_validate().form())return!1;if(n.data("wcpw-epo-data")&&n.data("wcpw-epo-data").functions&&!n.data("wcpw-epo-data").functions.apply_submit_events(n.data("wcpw-epo-data").epo))return!1;var c,d=o.tm_aserializeObject?o.tm_aserializeObject():o.tcSerializeObject(),s=_createForOfIteratorHelper(d);try{for(s.s();!(c=s.n()).done;){var p=c.value,l=d[p];Array.isArray(l)&&0===(l=l.filter((function(t){return""!==t}))).length&&(d[p]="")}}catch(t){s.e(t)}finally{s.f()}return t.request=Object.assign(d,a),!0},saveExtraProductOptionsAttachments:function(t,e){if(void 0!==$.tcepo){var o,r=_createForOfIteratorHelper(t.element.querySelectorAll('.tc-extra-product-options input[type="file"]'));try{for(r.s();!(o=r.n()).done;){var n=o.value;n.files[0]&&n.files[0].size&&e.append(n.name,n.files[0])}}catch(t){r.e(t)}finally{r.f()}}},reInitCheckoutScript:function(){var t=this.documentNode.querySelector("#wc-checkout-js");if(!t)return this;var e=t.getAttribute("src"),o=t.getAttribute("id"),r=this.documentNode.createElement("script");return t.remove(),this.$body&&(this.$body.off("click","a.showcoupon"),this.$body.off("click",".woocommerce-remove-coupon"),this.$body.off("click","a.showlogin"),this.$body.off("click","a.woocommerce-terms-and-conditions-link")),r.src=e,r.id=o,this.documentNode.body.appendChild(r),this.$body&&this.$body.trigger("country_to_state_changed"),this},updateStickyObserverElementsState:function(){if(this.stickyObserverElements&&!(this.stickyObserverElements.length<=0)){var t,e=_createForOfIteratorHelper(this.stickyObserverElements);try{for(e.s();!(t=e.n()).done;){var o=t.value;if(o.parentElement){var r=o.parentElement.getBoundingClientRect().top,n=Math.round(o.getBoundingClientRect().top-r);o.style.position="static",o.toggleAttribute("stuck",n!==Math.round(o.getBoundingClientRect().top-r)),o.style.position="",o.dataset.prevClientTop=String(n)}}}catch(t){e.e(t)}finally{e.f()}}}};wcpw.windowNode.addEventListener("load",(function(){wcpw.stickyObserverElements=wcpw.documentNode.querySelectorAll('[data-component~="wcpw-sticky-observer"]'),!wcpw.stickyObserverElements||wcpw.stickyObserverElements.length<=0||(wcpw.updateStickyObserverElementsState(),wcpw.windowNode.addEventListener("resize",(function(){return setTimeout((function(){return wcpw.updateStickyObserverElementsState()}),0)})),wcpw.windowNode.addEventListener("scroll",(function(){var t,e=_createForOfIteratorHelper(wcpw.stickyObserverElements);try{for(e.s();!(t=e.n()).done;){var o=t.value;if(o.parentElement){var r=Math.round(o.getBoundingClientRect().top-o.parentElement.getBoundingClientRect().top);o.toggleAttribute("stuck",Number(o.dataset.prevClientTop)!==r),o.dataset.prevClientTop=String(r)}}}catch(t){e.e(t)}finally{e.f()}}),!1))})),wcpw.documentNode.addEventListener("DOMContentLoaded",(function(){wcpw.init(),"undefined"!=typeof wpcf7&&wcpw.documentNode.addEventListener("ajaxCompleted.wcpw",(function(t){var e=t.detail.instance.element.querySelector(".wpcf7-form");e&&(void 0!==wpcf7.initForm?wpcf7.initForm($(e)):void 0!==wpcf7.init&&wpcf7.init(e))})),void 0!==$&&void 0!==$.tcepo&&(wcpw.documentNode.addEventListener("submit.wcpw",(function(t){var e=t.detail.instance,o=t.detail.data;if(e&&o){var r,n=_createForOfIteratorHelper(o.productsToAdd);try{for(n.s();!(r=n.n()).done;){var i=r.value,a=o.productsToAdd[i];void 0===o.productsToAddChecked[a.step_id]||-1===o.productsToAddChecked[a.step_id].indexOf(a.product_id)||wcpw.saveExtraProductOptions(a)||(e.hasError=!0,e.productsWithError.push(a))}}catch(t){n.e(t)}finally{n.f()}}})),wcpw.documentNode.addEventListener("ajaxRequest.wcpw",(function(t){wcpw.saveExtraProductOptionsAttachments(t.detail.instance,t.detail.data)})))})),wcpw.documentNode.addEventListener("init.wcpw",(function(){return wcpw.init()})),wcpw.documentNode.addEventListener("launched.wcpw",(function(t){var e=t.detail.instance;wcpw.onInit(t),void 0!==$&&setTimeout((function(){$(e.element).find('[data-component~="wcpw-product-variations"]').off(".wc-variation-form")}),100)})),wcpw.documentNode.addEventListener("ajaxCompleted.wcpw",(function(t){var e=t.detail.instance,o=t.detail.response;if(wcpw.onInit(t),wcpw.stickyObserverElements=e.element.querySelectorAll('[data-component~="wcpw-sticky-observer"]'),wcpw.updateStickyObserverElementsState(),wcpw.$body&&e.options&&e.options.reflectInMainCart&&wcpw.$body.trigger("wc_fragment_refresh"),e.options&&e.options.enableCheckoutStep&&o.finalRedirectUrl&&o.preventRedirect&&wcpw.reInitCheckoutScript(),o.hasError){var r=e.element.querySelector('[data-component~="wcpw-message"]');r&&!e.isScrolledIntoView(r)&&e.scrollToElement(r,e.options.scrollingUpGap),e.vibrate()}})),wcpw.documentNode.addEventListener("submitError.wcpw",(function(t){var e=t.detail.instance;if(e&&!(e.productsWithError.length<=0)){var o=e.element.querySelector('[data-component~="wcpw-product"][data-id="'.concat(e.productsWithError[0].product_id,'"]')+'[data-step-id="'.concat(e.productsWithError[0].step_id,'"]'));if(o){if(e.isScrolledIntoView(o)||e.scrollToElement(o,e.options.scrollingUpGap),void 0!==$.fn.modal){var r=$(o).find('[data-component~="wcpw-product-modal"] .tc-extra-product-options');r.length>0&&r.closest('[data-component~="wcpw-product-modal"]').modal("show")}e.vibrate()}}})),wcpw.documentNode.addEventListener("ajaxRequest.wcpw",(function(t){var e=t.detail.instance;void 0!==$&&void 0!==$.fn.modal&&$(e.element).find('[data-component~="wcpw-product-modal"].show').modal("hide")})),wcpw.documentNode.addEventListener("toggle.wcpw",(function(){wcpw.$body&&wcpw.$body.trigger("sticky_kit:recalc")})),wcpw.$document&&(wcpw.$document.on("hide_variation",".variations_form",(function(){var t=this.closest(".product").querySelector('[data-component~="wcpw-add-to-cart"][form="'.concat(this.getAttribute("id"),'"]'));t.length>0&&(t.classList.add("disabled"),t.setAttribute("disabled","disabled"))})),wcpw.$document.on("show_variation",".variations_form",(function(){var t=this.closest(".product").querySelector('[data-component~="wcpw-add-to-cart"][form="'.concat(this.getAttribute("id"),'"]'));t.length>0&&(t.classList.remove("disabled"),t.removeAttribute("disabled"))}))),wcpw.$window&&wcpw.$window.on("tm-from-submit",(function(t,e){e.epo&&$(e.epo.form.eq(0)).data("wcpw-epo-data",e)}));export default wcpw;