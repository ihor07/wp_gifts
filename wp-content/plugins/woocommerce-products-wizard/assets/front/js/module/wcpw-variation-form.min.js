function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _createForOfIteratorHelper(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var a=0,i=function(){};return{s:i,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){c=!0,n=t},f:function(){try{o||null==r.return||r.return()}finally{if(c)throw n}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,a=new Array(e);r<e;r++)a[r]=t[r];return a}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,_toPropertyKey(a.key),a)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"===_typeof(e)?e:String(e)}function _toPrimitive(t,e){if("object"!==_typeof(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var a=r.call(t,e||"default");if("object"!==_typeof(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var WCPWVariationForm=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,t),this.element=e,this.customOptions=r,this.options=Object.assign({},r)}return _createClass(t,[{key:"init",value:function(){return this.eventListeners=[],this.$reset=this.element.querySelectorAll('[data-component~="wcpw-product-variations-reset"]'),this.id=this.element.querySelector('[data-component~="wcpw-product-variations-variation-id"]'),this.$input=this.element.querySelectorAll('[data-component~="wcpw-product-variations-item-input"]'),this.$variationItem=this.element.querySelectorAll('[data-component~="wcpw-product-variations-item"]'),this.$variationItemValue=this.element.querySelectorAll('[data-component~="wcpw-product-variations-item-value"]'),this.product=this.element.closest('[data-component~="wcpw-product"]'),this.$productPrice=this.product.querySelectorAll('[data-component~="wcpw-product-price"]'),this.$productQuantity=this.product.querySelector('[data-component~="wcpw-product-quantity"] input:not([type="button"])'),this.$productDescription=this.product.querySelectorAll('[data-component~="wcpw-product-description"]'),this.$productAvailability=this.product.querySelectorAll('[data-component~="wcpw-product-availability"]'),this.$productSku=this.product.querySelectorAll('[data-component~="wcpw-product-sku"]'),this.$productAddToCart=this.product.querySelectorAll('[data-component~="wcpw-add-cart-product"]'),this.$productChoose=this.product.querySelectorAll('[data-component~="wcpw-product-choose"]'),this.$productImage=this.product.querySelectorAll('[data-component~="wcpw-product-thumbnail-image"]'),this.$productLink=this.product.querySelectorAll('[data-component~="wcpw-product-thumbnail-link"]'),this.initEventListeners().triggerEvent("launched.variationForm.wcpw",{instance:this})}},{key:"initEventListeners",value:function(){var t=this,e=this;return this.unDelegateEventListener("change.input.variationForm.wcpw",'[data-component~="wcpw-product-variations-item-input"]'),this.element.addEventListener("check_variations",(function(e){var r,a={},i=!0,n=_createForOfIteratorHelper(t.$input);try{for(n.s();!(r=n.n()).done;){var o=r.value;"SELECT"!==o.tagName||o.value&&0!==o.value.length||(i=!1),("SELECT"===o.tagName||o.checked)&&(a[o.getAttribute("data-name")]=o.value)}}catch(t){n.e(t)}finally{n.f()}var c=t.findMatchingVariations(JSON.parse(t.element.getAttribute("data-product_variations")||"{}"),a);if(i){var l=null;for(var s in c)if(c.hasOwnProperty(s)){var u=t.extendObject(a),d=t.extendObject(c[s].attributes);for(var v in d)d.hasOwnProperty(v)&&""===d[v]&&(d[v]=u[v]);if(JSON.stringify(d)===JSON.stringify(u)){l=c[s];break}}l?(t.id.value=l.variation_id,t.triggerEvent("found_variation",{variation:l})):e.detail.focus||(t.triggerEvent("reset_image"),t.triggerEvent("hide_variation"))}else if(e.detail.focus||(t.triggerEvent("reset_image"),t.triggerEvent("hide_variation")),!e.detail.exclude){var p,f=_createForOfIteratorHelper(t.$productPrice);try{for(f.s();!(p=f.n()).done;){var h=p.value;h.innerHTML=h.getAttribute("data-default")}}catch(t){f.e(t)}finally{f.f()}var y,m=_createForOfIteratorHelper(t.$productDescription);try{for(m.s();!(y=m.n()).done;){var g=y.value;g.innerHTML=g.getAttribute("data-default")}}catch(t){m.e(t)}finally{m.f()}var b,_=_createForOfIteratorHelper(t.$productAvailability);try{for(_.s();!(b=_.n()).done;){var w=b.value;w.innerHTML=w.getAttribute("data-default")}}catch(t){_.e(t)}finally{_.f()}var A,O=_createForOfIteratorHelper(t.$productSku);try{for(O.s();!(A=O.n()).done;){var S=A.value;S.innerHTML=S.getAttribute("data-default")}}catch(t){O.e(t)}finally{O.f()}}t.triggerEvent("update_variation_values",{variations:t.extendObject(c),currentSettings:t.extendObject(a)});var I,$=_createForOfIteratorHelper(t.$productAddToCart);try{for($.s();!(I=$.n()).done;){I.value.disabled=!t.id.value}}catch(t){$.e(t)}finally{$.f()}var k,E=_createForOfIteratorHelper(t.$productChoose);try{for(E.s();!(k=E.n()).done;){k.value.disabled=!t.id.value}}catch(t){E.e(t)}finally{E.f()}})),this.element.addEventListener("reset_image",(function(){return t.updateImage(!1)})),this.element.addEventListener("update_variation_values",(function(r){var a=r.detail.variation;if(!a||Object.keys(a).length<=0)return t;var i,n=!0,o=_createForOfIteratorHelper(t.$variationItem);try{var c=function(){var t,r=i.value,o=r.getAttribute("data-name"),c=r.querySelectorAll('[data-component~="wcpw-product-variations-item-value"]'),l=_createForOfIteratorHelper(c);try{for(l.s();!(t=l.n()).done;){var s=t.value;s.classList.remove("active"),s.disabled=!1}}catch(t){l.e(t)}finally{l.f()}for(var u in a)if(a.hasOwnProperty(u)){var d=e.extendObject(a[u].attributes);for(var v in d)if(d.hasOwnProperty(v)&&v===o){var p=d[v];if(!p){var f=e.extendObject(currentSettings),h=e.extendObject(d);for(var y in delete h[v],delete f[v],h)h.hasOwnProperty(y)&&""===h[y]&&(delete h[y],delete f[y]);if(JSON.stringify(h)===JSON.stringify(f)){var m,g=_createForOfIteratorHelper(c);try{for(g.s();!(m=g.n()).done;){m.value.classList.add("active")}}catch(t){g.e(t)}finally{g.f()}}}p=(p=(p=decodeURIComponent(p)).replace(/'/g,"\\'")).replace(/"/g,'\\"');var b,_=_createForOfIteratorHelper(c);try{for(_.s();!(b=_.n()).done;){var w=b.value;p?w.value===p&&w.classList.add("active"):w.classList.add("active")}}catch(t){_.e(t)}finally{_.f()}}}var A,O=_createForOfIteratorHelper(r.querySelectorAll('[data-component~="wcpw-product-variations-item-value"]:not(.active)'));try{for(O.s();!(A=O.n()).done;){A.value.disabled=!0}}catch(t){O.e(t)}finally{O.f()}if("SELECT"===r.tagName){var S=r.querySelector("option:checked");if(S.getAttribute("selected")||(n=!1),S.disabled){var I=r.querySelector("option:not(:disabled)");I&&setTimeout((function(){r.value=I.value}),0)}}else{var $=r.querySelector('[data-component~="wcpw-product-variations-item-value"]:checked');if($.getAttribute("checked")||(n=!1),$.disabled){var k=r.querySelector('[data-component~="wcpw-product-variations-item-value"]:not(:disabled)');k&&setTimeout((function(){k.checked=!0}),0)}}};for(o.s();!(i=o.n()).done;)c()}catch(t){o.e(t)}finally{o.f()}var l,s=_createForOfIteratorHelper(t.$reset);try{for(s.s();!(l=s.n()).done;){l.value.setAttribute("hidden",String(n))}}catch(t){s.e(t)}finally{s.f()}return t.triggerEvent("woocommerce_update_variation_values"),t})),this.element.addEventListener("found_variation",(function(e){var r=!0,a=e.detail.variation;if(a.price_html){var i,n=_createForOfIteratorHelper(t.$productPrice);try{for(n.s();!(i=n.n()).done;){i.value.innerHTML=a.price_html}}catch(t){n.e(t)}finally{n.f()}}t.$productQuantity&&a.min_qty&&t.$productQuantity.setAttribute("min",a.min_qty),t.$productQuantity&&a.max_qty&&t.$productQuantity.setAttribute("max",a.max_qty);var o,c=_createForOfIteratorHelper(t.$productDescription);try{for(c.s();!(o=c.n()).done;){var l=o.value;l.innerHTML=a.description||a.variation_description||l.getAttribute("data-default")}}catch(t){c.e(t)}finally{c.f()}var s,u=_createForOfIteratorHelper(t.$productAvailability);try{for(u.s();!(s=u.n()).done;){var d=s.value;d.innerHTML=a.availability_html||d.getAttribute("data-default")}}catch(t){u.e(t)}finally{u.f()}var v,p=_createForOfIteratorHelper(t.$productSku);try{for(p.s();!(v=p.n()).done;){var f=v.value;f.innerHTML=a.sku||f.getAttribute("data-default")}}catch(t){p.e(t)}finally{p.f()}a.is_purchasable&&a.is_in_stock&&a.variation_is_visible||(r=!1);var h,y=_createForOfIteratorHelper(t.$productAddToCart);try{for(y.s();!(h=y.n()).done;){h.value.disabled=!r}}catch(t){y.e(t)}finally{y.f()}var m,g=_createForOfIteratorHelper(t.$productChoose);try{for(g.s();!(m=g.n()).done;){m.value.disabled=!r}}catch(t){g.e(t)}finally{g.f()}return t.updateImage(a)})),this.element.addEventListener("reset",(function(){var e,r=_createForOfIteratorHelper(t.$variationItemValue);try{for(r.s();!(e=r.n()).done;){var a=e.value,i="INPUT"===a.tagName;a.disabled=!1,a.checked=i?a.defaultChecked:a.defaultSelected}}catch(t){r.e(t)}finally{r.f()}var n,o=_createForOfIteratorHelper(t.$reset);try{for(o.s();!(n=o.n()).done;){n.value.setAttribute("hidden",!0)}}catch(t){o.e(t)}finally{o.f()}t.triggerEvent("check_variations")})),this.delegateEventListener("change.input.variationForm.wcpw",'[data-component~="wcpw-product-variations-item-input"]',(function(){e.id.value="",e.triggerEvent("woocommerce_variation_select_change"),e.triggerEvent("check_variations",{exclude:this.getAttribute("data-name"),focus:!0})})),this.delegateEventListener("click.reset.variationForm.wcpw",'[data-component~="wcpw-product-variations-reset"]',(function(e){return e.preventDefault(),t.triggerEvent("reset")})),this.triggerEvent("check_variations"),this.triggerEvent("wc_variation_form"),this}},{key:"delegateEventListener",value:function(t,e,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{capture:!1},i=t.split(".")[0],n=function(t){for(var a=t.target;a&&!a.matches(e)&&a!==this;)a=a.parentElement;return a&&a.matches(e)&&r.call(a,t),this};return this.eventListeners.push({action:t,actionName:i,selector:e,handler:n}),this.element.addEventListener(i,n,a),this}},{key:"unDelegateEventListener",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{capture:!1},a=this.eventListeners.filter((function(r){return r.action===t&&(!e||r.selector===e)}));return a[0]&&this.element.removeEventListener(a[0].actionName,a[0].handler,r),this}},{key:"triggerEvent",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.element.dispatchEvent(new CustomEvent(t,{bubbles:!0,detail:e})),this}},{key:"resetAttr",value:function(t,e){var r,a=_createForOfIteratorHelper(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;i.getAttribute("data-o_".concat(e))&&i.setAttribute(e,i.getAttribute("data-o_".concat(e)))}}catch(t){a.e(t)}finally{a.f()}return this}},{key:"setAttr",value:function(t,e,r){var a,i=_createForOfIteratorHelper(t);try{for(i.s();!(a=i.n()).done;){var n=a.value;n.getAttribute("data-o_".concat(e))&&n.setAttribute("data-o_".concat(e),n.getAttribute(e)?n.getAttribute(e):""),!1===r?n.removeAttribute(e):n.setAttribute(e,r)}}catch(t){i.e(t)}finally{i.f()}return this}},{key:"updateImage",value:function(t){return t&&t.image&&(t.image.src||t.image_src)?(this.setAttr(this.$productImage,"src",t.image_src||t.image.src),this.setAttr(this.$productImage,"srcset",t.image_srcset||t.image.srcset),this.setAttr(this.$productImage,"sizes",t.image_sizes||t.image.sizes),this.setAttr(this.$productImage,"title",t.image_title||t.image.title),this.setAttr(this.$productImage,"alt",t.image_alt||t.image.alt),this.setAttr(this.$productLink,"href",t.image_link||t.image.full_src)):(this.resetAttr(this.$productImage,"src"),this.resetAttr(this.$productImage,"srcset"),this.resetAttr(this.$productImage,"sizes"),this.resetAttr(this.$productImage,"alt"),this.resetAttr(this.$productLink,"href")),this}},{key:"findMatchingVariations",value:function(t,e){var r=[],a={};for(var i in t)if(t.hasOwnProperty(i)){var n=t[i];for(var o in e)if(e.hasOwnProperty(o)){var c=this.extendObject(n.attributes),l=this.extendObject(e);for(var s in delete c[o],delete l[o],c)c.hasOwnProperty(s)&&""===c[s]&&(delete c[s],delete l[s]);JSON.stringify(c)!==JSON.stringify(l)||a.hasOwnProperty(n.variation_id)||(a[n.variation_id]=n.variation_id,r.push(n))}}return r}},{key:"extendObject",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return Object.assign.apply(Object,[{}].concat(e))}}]),t}();export default WCPWVariationForm;