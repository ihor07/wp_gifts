function _defineProperty(t,e,r){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _createForOfIteratorHelper(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var a=0,i=function(){};return{s:i,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,n=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw n}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,a=new Array(e);r<e;r++)a[r]=t[r];return a}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,_toPropertyKey(a.key),a)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"===_typeof(e)?e:String(e)}function _toPrimitive(t,e){if("object"!==_typeof(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var a=r.call(t,e||"default");if("object"!==_typeof(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var WCPW=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,t);var a={documentNode:document,windowNode:window,rootSelector:"html, body",searchStringMinLength:3,ajaxActions:{submit:"wcpwSubmit",addToMainCart:"wcpwAddToMainCart",getStep:"wcpwGetStep",skipStep:"wcpwSkipStep",skipAll:"wcpwSkipAll",submitAndSkipAll:"wcpwSubmitAndSkipAll",reset:"wcpwReset",addCartProduct:"wcpwAddCartProduct",removeCartProduct:"wcpwRemoveCartProduct",updateCartProduct:"wcpwUpdateCartProduct",addCartStepData:"wcpwAddCartStepData",removeCartStepData:"wcpwRemoveCartStepData",search:"wcpwSearch"}};this.element=e,this.customOptions=r,this.options=Object.assign({},a,r)}return _createClass(t,[{key:"init",value:function(){return this.hasError=!1,this.preventAjaxRequest=!1,this.productsWithError=[],this.ajaxRequestsQueue=[],this.eventListeners=[],this.initEventListeners().triggerEvent("launched.wcpw",{instance:this})}},{key:"ajaxRequest",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.preventAjaxRequest=!1;var a=this,i=t instanceof FormData?t:new FormData,n={updateQueryArgs:!0,queryArgs:{},currentQueryArgs:this.getQueryArgs(),cache:"default",method:"post",scrollingTopOnUpdate:Boolean(this.options.scrollingTopOnUpdate),scrollingGap:Number(this.options.scrollingUpGap),scrollingBehavior:"smooth",scrollingToElement:null,passProducts:!1,passStepData:!1,errorsAlerting:!0,errorsLogging:!0,lazy:!1};if(r=this.extendObject(n,r),!(t instanceof FormData))for(var o in t)t.hasOwnProperty(o)&&i.append(o,"string"!=typeof t[o]?JSON.stringify(t[o]):t[o]);if(delete t.stepsData,r.passStepData){var s,c=this.element.querySelector('[data-component~="wcpw-form"]')||this.options.documentNode.querySelector('[data-component~="wcpw-form"]'),u=new FormData(c),d=i.get("stepDataToAddKey"),p=_createForOfIteratorHelper(u.entries());try{for(p.s();!(s=p.n()).done;){var l=s.value;if(l[0].includes("stepsData")&&("object"===_typeof(l[1])&&l[1].name||"string"==typeof l[1])){if(d&&l[0]!==d)continue;i.append(l[0],l[1])}}}catch(t){p.e(t)}finally{p.f()}}for(var h in r.passProducts||(i.delete("productsToAdd"),i.delete("productsToAddChecked")),this.customOptions)this.customOptions.hasOwnProperty(h)&&i.append(h,"string"!=typeof this.customOptions[h]?JSON.stringify(this.customOptions[h]):this.customOptions[h]);if(i.delete("add-to-cart"),r.currentQueryArgs.get&&(r.currentQueryArgs.has("wcpwFilter")&&i.append("wcpwFilter",r.currentQueryArgs.get("wcpwFilter")),r.currentQueryArgs.has("wcpwPage")&&i.append("wcpwPage",r.currentQueryArgs.get("wcpwPage")),r.currentQueryArgs.has("wcpwProductsPerPage")&&i.append("wcpwProductsPerPage",r.currentQueryArgs.get("wcpwProductsPerPage")),r.currentQueryArgs.has("wcpwOrderBy")&&i.append("wcpwOrderBy",r.currentQueryArgs.get("wcpwOrderBy"))),r.queryArgs)for(var g in r.queryArgs)r.queryArgs.hasOwnProperty(g)&&i.append(g,r.queryArgs[g]);if(this.triggerEvent("ajaxRequest.wcpw",{instance:a,formData:i,options:r}),this.preventAjaxRequest)return this.triggerEvent("ajaxPrevent.wcpw",{instance:a,formData:i,options:r}),Promise.resolve();this.element.classList.add(r.lazy?"is-lazy-loading":"is-loading"),this.element.setAttribute("aria-live","polite"),this.element.setAttribute("aria-busy","true");var w=this.options.windowNode.fetch(this.options.ajaxUrl,{method:r.method,cache:r.cache,body:i}).then((function(t){return t.json()})).then((function(t){e.triggerEvent("ajaxSuccess.wcpw",{instance:a,response:t,formData:i,options:r});var n=e.ajaxRequestsQueue.indexOf(w);if(n>-1&&e.ajaxRequestsQueue.splice(n,1),r.lazy&&e.ajaxRequestsQueue.length>0)return t;e.element.classList.remove("is-lazy-loading","is-loading"),e.element.setAttribute("aria-busy","false"),t.content&&(e.element.innerHTML=t.content);var o,s=_createForOfIteratorHelper(e.element.querySelectorAll('[data-component~="wcpw-nav"]'));try{for(s.s();!(o=s.n()).done;){var c=o.value,u=c.querySelector('[data-component~="wcpw-nav-list"]');u&&(u.scrollLeft=c.querySelector(".active").offsetLeft)}}catch(t){s.e(t)}finally{s.f()}if(r.scrollingTopOnUpdate){var d=e.element.querySelector(r.scrollingToElement||'[data-component~="wcpw-form-step"].is-active');d&&!e.isScrolledIntoView(d)&&e.scrollToElement(d,Number(r.scrollingGap),r.scrollingBehavior)}return r.updateQueryArgs&&r.queryArgs&&(t.hasOwnProperty("stateHash")&&(r.queryArgs.wcpwStateHash=t.stateHash),t.hasOwnProperty("saveStateToURL")&&Boolean(t.saveStateToURL)?(t.hasOwnProperty("id")&&(r.queryArgs.wcpwId=t.id),t.hasOwnProperty("stepId")&&(r.queryArgs.wcpwStep=t.stepId),t.hasOwnProperty("cart")&&(r.queryArgs.wcpwCart=JSON.stringify(t.cart))):r.queryArgs.wcpwStep=!1,0!==Object.keys(r.queryArgs).filter((function(t){return!1!==r.queryArgs[t]})).length&&e.setQueryArg(r.queryArgs)),e.triggerEvent("ajaxCompleted.wcpw",{instance:a,response:t,formData:i,options:r}),t})).catch((function(t){e.triggerEvent("ajaxError.wcpw",{instance:a,error:t,formData:i,options:r});var n=e.ajaxRequestsQueue.indexOf(w);return n>-1&&e.ajaxRequestsQueue.splice(n,1),e.element.classList.remove("is-lazy-loading","is-loading"),e.element.setAttribute("aria-busy","false"),r.errorsLogging&&e.options.windowNode.console.error(t),r.errorsAlerting&&e.options.windowNode.alert("Unexpected error occurred: ".concat(t)),t}));return this.ajaxRequestsQueue.push(w),w}},{key:"search",value:function(t,e,r){if(!t||t.length<this.options.searchStringMinLength)return Promise.resolve();var a=this.element.querySelector(e),i=a.getAttribute("data-item-template"),n={action:this.options.ajaxActions.search,id:this.options.id,query:t};return this.options.windowNode.fetch(this.options.ajaxUrl+"?"+this.objectToQueryParam(this.extendObject(n,r))).then((function(t){return t.json()})).then((function(t){var e=[];if(t.items.length>0)for(var r in t.items)if(t.items.hasOwnProperty(r)){var n=i;for(var o in t.items[r])t.items[r].hasOwnProperty(o)&&(n=n.replace(new RegExp("\\${"+o+"}","g"),t.items[r][o]));e.push(n)}return a.innerHTML=e.join(""),t}))}},{key:"delegateEventListener",value:function(t,e,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{capture:!1},i=t.split(".")[0],n=function(t){for(var a=t.target;a&&!a.matches(e)&&a!==this;)a=a.parentElement;return a&&a.matches(e)&&r.call(a,t),this};return this.eventListeners.push({action:t,actionName:i,selector:e,handler:n}),this.element.addEventListener(i,n,a),this}},{key:"unDelegateEventListener",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{capture:!1},a=this.eventListeners.filter((function(r){return r.action===t&&(!e||r.selector===e)}));return a[0]&&this.element.removeEventListener(a[0].actionName,a[0].handler,r),this}},{key:"initEventListeners",value:function(){var t=this,e=this;return this.options.windowNode.addEventListener("popstate",(function(e){return t.popState(e)}),!1),this.delegateEventListener("click.thumbnail.product.wcpw",'[data-component~="wcpw-product-thumbnail-link"]',(function(t){return t.preventDefault()})),this.delegateEventListener("click.product.wcpw",'[data-component~="wcpw-product"]',(function(){var t=this.querySelector('[data-component~="wcpw-product-choose"][type="radio"]');!t||t.checked||t.disabled||(t.checked=!0,t.dispatchEvent(new Event("change")))})),this.delegateEventListener("click.add.product.cart.wcpw",'[data-component~="wcpw-add-cart-product"]',(function(t){var r=this;if(this.classList.contains("disabled"))return t.preventDefault();var a,i=[],n=this.closest('[data-component~="wcpw-product"]'),o=_createForOfIteratorHelper(e.element.querySelectorAll("input:not(:disabled),select:not(:disabled),textarea:not(:disabled)"));try{for(o.s();!(a=o.n()).done;){var s=a.value;n.contains(s)||i.push(s)}}catch(t){o.e(t)}finally{o.f()}if(!e.options.documentNode.querySelector("#"+this.getAttribute("form")).checkValidity()){var c,u=_createForOfIteratorHelper(i);try{for(u.s();!(c=u.n()).done;){c.value.disabled=!1}}catch(t){u.e(t)}finally{u.f()}return this}for(var d=0,p=i;d<p.length;d++){p[d].disabled=!1}return this.classList.add("is-loading"),this.setAttribute("aria-busy","true"),t.preventDefault(),e.addCartProduct({productToAddKey:this.value},JSON.parse(this.getAttribute("data-add-cart-product-options")||"{}")).finally((function(){r.classList.remove("is-loading"),r.setAttribute("aria-busy","false")}))})),this.delegateEventListener("click.update.product.cart.wcpw",'[data-component~="wcpw-update-cart-product"]',(function(t){var r=this;if(this.classList.contains("disabled"))return t.preventDefault();var a,i=[],n=this.closest('[data-component~="wcpw-product"]'),o=_createForOfIteratorHelper(e.element.querySelectorAll("input:not(:disabled),select:not(:disabled),textarea:not(:disabled)"));try{for(o.s();!(a=o.n()).done;){var s=a.value;n.contains(s)||i.push(s)}}catch(t){o.e(t)}finally{o.f()}for(var c=0,u=i;c<u.length;c++){u[c].disabled=!0}for(var d=0,p=i;d<p.length;d++){p[d].disabled=!0}if(!e.options.documentNode.querySelector("#"+this.getAttribute("form")).checkValidity()){var l,h=_createForOfIteratorHelper(i);try{for(h.s();!(l=h.n()).done;){l.value.disabled=!1}}catch(t){h.e(t)}finally{h.f()}return this}for(var g=0,w=i;g<w.length;g++){w[g].disabled=!1}return this.classList.add("is-loading"),this.setAttribute("aria-busy","true"),t.preventDefault(),e.updateCartProduct({productCartKey:this.value},JSON.parse(this.getAttribute("data-update-cart-product-options")||"{}")).finally((function(){r.classList.remove("is-loading"),r.setAttribute("aria-busy","false")}))})),this.delegateEventListener("click.remove.product.cart.wcpw",'[data-component~="wcpw-remove-cart-product"]',(function(t){var r=this;return t.preventDefault(),this.classList.add("is-loading"),this.setAttribute("aria-busy","true"),e.removeCartProduct({productCartKey:this.value},JSON.parse(this.getAttribute("data-remove-cart-product-options")||"{}")).finally((function(){r.classList.remove("is-loading"),r.setAttribute("aria-busy","false")}))})),this.delegateEventListener("change.add.stepData.cart.wcpw",'[data-component~="wcpw-add-cart-step-data"]',(function(t){var r=this;return this.classList.contains("disabled")?t.preventDefault():(t.preventDefault(),this.classList.add("is-loading"),this.setAttribute("aria-busy","true"),e.addCartStepData({stepDataToAddKey:this.getAttribute("name")},JSON.parse(this.getAttribute("data-add-cart-step-data-options")||"{}")).finally((function(){r.classList.remove("is-loading"),r.setAttribute("aria-busy","false")})))})),this.delegateEventListener("change.remove.stepData.cart.wcpw",'[data-component~="wcpw-remove-cart-step-data"]',(function(t){var r=this;return t.preventDefault(),this.classList.add("is-loading"),this.setAttribute("aria-busy","true"),e.removeCartStepData({stepDataKey:this.getAttribute("data-name"),stepId:this.getAttribute("data-step-id")},JSON.parse(this.getAttribute("data-remove-cart-step-data-options")||"{}")).finally((function(){r.classList.remove("is-loading"),r.setAttribute("aria-busy","false")}))})),this.delegateEventListener("click.nav.wcpw",'[data-component~="wcpw-nav-item"]',(function(t){var r=this.getAttribute("data-nav-action"),a={action:r};return e.options.documentNode.querySelector("#"+this.getAttribute("form")).checkValidity()||-1===["submit","add-to-main-cart","add-to-main-cart-repeat"].indexOf(r)?(t.preventDefault(),this.getAttribute("data-nav-id")&&(a.stepId=this.getAttribute("data-nav-id")),e.navRouter(a)):this})),this.delegateEventListener("click.share.wcpw",'[data-component~="wcpw-share"]',(function(t){return e.setClipboard(this.getAttribute("href"))&&(t.preventDefault(),this.querySelector("*").innerText=this.getAttribute("data-share-success-message")),this})),this.delegateEventListener("submit.filter.wcpw",'[data-component~="wcpw-filter"]',(function(t){t.preventDefault();var r=e.getQueryArgs(),a=e.serializeObject(this).wcpwFilter,i=this.getAttribute("data-step-id"),n={},o={};return r.get&&(r.has("wcpwFilter")&&r.get("wcpwFilter")&&(o=e.queryStringToObject(r.get("wcpwFilter"))),r.has("wcpwPage")&&r.get("wcpwPage")&&((n=e.queryStringToObject(r.get("wcpwPage")))[i]=1)),o=e.extendObject(o,a),e.getStep({stepId:i},{queryArgs:{wcpwFilter:e.objectToQueryParam(o),wcpwPage:e.objectToQueryParam(n)}})})),this.delegateEventListener("reset.filter.wcpw",'[data-component~="wcpw-filter"]',(function(t){t.preventDefault();var r=e.getQueryArgs(),a=e.serializeObject(this).wcpwFilter,i=this.getAttribute("data-step-id"),n={};return r.get&&r.has("wcpwFilter")&&(n=e.queryStringToObject(r.get("wcpwFilter"))),n=e.extendObject(n,_defineProperty({},Object.keys(a)[0],{})),e.getStep({stepId:i},{queryArgs:{wcpwFilter:e.objectToQueryParam(n)}})})),this.delegateEventListener("change.autoSubmit.wcpw",'[data-component~="wcpw-submit-on-change"]',(function(){this.dispatchEvent(new Event("submit",{bubbles:!0}))})),this.delegateEventListener("input.search.wcpw",'[data-component~="wcpw-search-form-input"]',(function(){var t=this,r=e.serializeObject(this.closest('[data-component~="wcpw-filter"]'));return this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchPromise&&this.searchPromise.abort&&this.searchPromise.abort(),r.stepId=this.getAttribute("data-step-id"),this.searchTimeout=setTimeout((function(){t.classList.add("is-loading"),t.setAttribute("aria-busy","true"),t.searchPromise=e.search(t.value,t.getAttribute("data-target"),r).finally((function(){t.classList.remove("is-loading"),t.setAttribute("aria-busy","false")}))}),1e3),this.searchTimeout})),this.delegateEventListener("click.result.search.wcpw",'[data-component~="wcpw-search-form-results"] [data-value]',(function(t){t.preventDefault();var r=this.closest('[data-component~="wcpw-search-form-results"]').getAttribute("data-target");return r&&(e.element.querySelector(r).value=this.getAttribute("data-value")),this})),this.delegateEventListener("click.pagination.wcpw",'[data-component~="wcpw-form-pagination-link"]',(function(t){t.preventDefault();var r=e.getQueryArgs(),a=this.getAttribute("data-step-id"),i=this.getAttribute("data-page"),n={};return r.get&&r.has("wcpwPage")&&r.get("wcpwPage")&&(n=e.queryStringToObject(r.get("wcpwPage"))),n[a]=i,e.getStep({stepId:a,page:i},{queryArgs:{wcpwPage:e.objectToQueryParam(n)},scrollingTopOnUpdate:!0,scrollingToElement:'[data-component~="wcpw-form-step"][data-id="'.concat(a,'"]')})})),this.delegateEventListener("submit.productsPerPage.wcpw",'[data-component~="wcpw-form-products-per-page"]',(function(t){t.preventDefault();var r=e.getQueryArgs(),a=e.serializeObject(this),i=this.getAttribute("data-step-id"),n={},o={};return r.get&&(r.has("wcpwProductsPerPage")&&(o=e.queryStringToObject(r.get("wcpwProductsPerPage"))),r.has("wcpwPage")&&r.get("wcpwPage")&&((n=e.queryStringToObject(r.get("wcpwPage")))[i]=1)),o[i]=a.wcpwProductsPerPage[i],e.getStep({stepId:i},{queryArgs:{wcpwProductsPerPage:e.objectToQueryParam(o),wcpwPage:e.objectToQueryParam(n)}})})),this.delegateEventListener("submit.orderBy.wcpw",'[data-component~="wcpw-form-order-by"]',(function(t){t.preventDefault();var r=e.getQueryArgs(),a=e.serializeObject(this),i=this.getAttribute("data-step-id"),n={};return r.get&&r.has("wcpwOrderBy")&&(n=e.queryStringToObject(r.get("wcpwOrderBy"))),n[i]=a.wcpwOrderBy[i],e.getStep({stepId:i},{queryArgs:{wcpwOrderBy:e.objectToQueryParam(n)}})})),this.delegateEventListener("click.toggle.wcpw",'[data-component~="wcpw-toggle"]',(function(t){t.preventDefault();var r=this.getAttribute("data-target")||this.getAttribute("href"),a=e.element.querySelector(r),i="false"===a.getAttribute("aria-expanded");return this.setAttribute("aria-expanded",i?"true":"false"),a.setAttribute("aria-expanded",i?"true":"false"),e.options.documentNode.cookie="".concat(r,"-expanded=").concat(String(i),"; path=/"),e.triggerEvent("toggle.wcpw",{instance:e,target:a}),this})),this}},{key:"triggerEvent",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.element.dispatchEvent(new CustomEvent(t,{bubbles:!0,detail:e})),this}},{key:"popState",value:function(t){var e={action:this.options.ajaxActions.getStep},r=t&&t.state&&t.state.path;if(!r)return Promise.resolve();var a=new URL(r).searchParams;return a.has("wcpwStep")&&(e.stepId=a.get("wcpwStep")),a.has("wcpwFilters")&&(e.filters=this.queryStringToObject(a.get("wcpwFilters"))[e.stepId]),a.has("wcpwPages")&&(e.page=this.queryStringToObject(a.get("wcpwPages"))[e.stepId]),a.has("wcpwOrderBy")&&(e.orderby=this.queryStringToObject(a.get("wcpwOrderBy"))[e.stepId]),this.ajaxRequest(e,{updateQueryArgs:!1})}},{key:"addCartProduct",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t=this.extendObject({action:this.options.ajaxActions.addCartProduct},t),(e=this.extendObject({behavior:"default",passProducts:!0,passStepData:!1},e)).behavior){default:case"default":return this.submit(t,this.extendObject({scrollingTopOnUpdate:!1},e));case"submit":return this.submit(t,e);case"add-to-main-cart":return this.addToMainCart(t,e)}}},{key:"updateCartProduct",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t=this.extendObject({action:this.options.ajaxActions.updateCartProduct},t),(e=this.extendObject({behavior:"default",passProducts:!0,passStepData:!1},e)).behavior){default:case"default":return this.submit(t,this.extendObject({scrollingTopOnUpdate:!1},e));case"submit":return this.submit(t,e);case"add-to-main-cart":return this.addToMainCart(t,e)}}},{key:"removeCartProduct",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t=this.extendObject({action:this.options.ajaxActions.removeCartProduct},t),e=this.extendObject({scrollingTopOnUpdate:!1,passProducts:!0},e),this.ajaxRequest(t,e)}},{key:"addCartStepData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch((e=this.extendObject({behavior:"default",passProducts:!1,passStepData:!0},e)).behavior){default:case"default":return this.submit(this.extendObject({action:this.options.ajaxActions.addCartStepData},t),this.extendObject({scrollingTopOnUpdate:!1},e));case"submit":return this.submit(t,e);case"add-to-main-cart":return this.addToMainCart(t,e)}}},{key:"removeCartStepData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t=this.extendObject({action:this.options.ajaxActions.removeCartStepData},t),e=this.extendObject({scrollingTopOnUpdate:!1},e),this.ajaxRequest(t,e)}},{key:"addToMainCart",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=this;e=this.extendObject({action:this.options.ajaxActions.addToMainCart},e),r=this.extendObject({preventRedirect:!1,passProducts:!0,passStepData:!0},r);var i=this.submit(e,r);return this.triggerEvent("addToMainCart.wcpw",{instance:a,data:e,result:i}),i?i.then((function(i){return i.hasError||t.hasError?(t.triggerEvent("addToMainCartError.wcpw",{instance:a,data:e,response:i}),i):(r.preventRedirect||i.preventRedirect||!i.finalRedirectUrl||(t.triggerEvent("addToMainCartRedirect.wcpw",{instance:a,data:e,response:i}),t.options.documentNode.location=i.finalRedirectUrl),i)})):Promise.resolve()}},{key:"addToMainCartRepeat",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.getContent=!0,e.preventRedirect=!0,this.addToMainCart(t,e)}},{key:"submit",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.hasError=!1,this.productsWithError=[];var r=this.element.querySelector('[data-component~="wcpw-form"]')||this.options.documentNode.querySelector('[data-component~="wcpw-form"]'),a=this.serializeObject(r),i={action:this.options.ajaxActions.submit,productToAddKey:null,productsToAdd:[],productsToAddChecked:[]};if(t=this.extendObject(i,t,a),e=this.extendObject({passProducts:!0,passStepData:!0},e),t.productToAddKey){for(var n in t.productsToAdd)if(t.productsToAdd.hasOwnProperty(n)){var o=t.productsToAdd[n];"".concat(o.step_id,"-").concat(o.product_id)!==t.productToAddKey?delete t.productsToAdd[n]:t.productsToAddChecked=_defineProperty({},o.step_id,[o.product_id])}}else delete t.productToAddKey;return this.triggerEvent("submit.wcpw",{instance:this,data:t}),this.hasError?(this.triggerEvent("submitError.wcpw",{instance:this,data:t}),Promise.resolve()):this.ajaxRequest(t,e)}},{key:"navRouter",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.action;switch(delete t.action,r){case"skip-step":return this.skipStep(t,e);case"skip-all":return this.skipAll(t,e);case"submit-and-skip-all":return this.submitAndSkipAll(t,e);case"submit":return this.submit(t,e);case"add-to-main-cart":return this.addToMainCart(t,e);case"add-to-main-cart-repeat":return this.addToMainCartRepeat(t,e);case"reset":return this.reset(t,e);case"none":return null;default:return this.getStep(t,e)}}},{key:"skipStep",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t=this.extendObject({action:this.options.ajaxActions.skipStep},t),this.ajaxRequest(t,e)}},{key:"submitAndSkipAll",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t=this.extendObject({action:this.options.ajaxActions.submitAndSkipAll},t),this.submit(t,e)}},{key:"skipAll",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t=this.extendObject({action:this.options.ajaxActions.skipAll},t),this.ajaxRequest(t,e)}},{key:"getStep",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t=this.extendObject({action:this.options.ajaxActions.getStep},t),this.ajaxRequest(t,e)}},{key:"reset",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t=this.extendObject({action:this.options.ajaxActions.reset},t),this.ajaxRequest(t,e)}},{key:"parseObject",value:function(t,e,r){var a=/^[^\[\]]+\[]/.test(e),i=/^[^\[\]]+\[[^\[\]]+]/.test(e),n=e.replace(/\[.*/,"");if(a)t[n]||(t[n]=[]);else{if(!i)return t.push?t.push(r):t[n]=r,null;t[n]||(t[n]={})}var o=e.match(/\[[^\[\]]*]/g);return o[0]=o[0].replace(/\[|]/g,""),this.parseObject(t[n],o.join(""),r)}},{key:"serializeObject",value:function(t){var e,r={},a=_createForOfIteratorHelper(new FormData(t).entries());try{for(a.s();!(e=a.n()).done;){var i=e.value;this.parseObject(r,i[0],i[1])}}catch(t){a.e(t)}finally{a.f()}return r}},{key:"getQueryArgs",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.windowNode.location.search;return"undefined"==typeof URLSearchParams?{}:new URLSearchParams(t)}},{key:"setQueryArg",value:function(t){if(!this.options.windowNode.history||!this.options.windowNode.history.pushState)return this;var e=this.getQueryArgs();if(!e.get)return this;for(var r in t)t.hasOwnProperty(r)&&("boolean"!=typeof t[r]||t[r]?e.set(r,t[r]):e.delete(r));var a=this.options.windowNode.location.protocol+"//"+this.options.windowNode.location.host+this.options.windowNode.location.pathname+"?"+e.toString();return this.options.windowNode.history.pushState({path:a},"",a),this}},{key:"queryStringToObject",value:function(t){var e={};if(!t)return e;var r=JSON.parse('{"'+decodeURI(t).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}');for(var a in r)r.hasOwnProperty(a)&&this.parseObject(e,a,r[a]);return e}},{key:"vibrate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[200];return"vibrate"in this.options.windowNode.navigator?this.options.windowNode.navigator.vibrate(t):"oVibrate"in this.options.windowNode.navigator?this.options.windowNode.navigator.oVibrate(t):"mozVibrate"in this.options.windowNode.navigator?this.options.windowNode.navigator.mozVibrate(t):"webkitVibrate"in this.options.windowNode.navigator&&this.options.windowNode.navigator.webkitVibrate(t),this}},{key:"setClipboard",value:function(t){if(this.options.windowNode.clipboardData&&this.options.windowNode.clipboardData.setData)return this.options.windowNode.clipboardData.setData("Text",t),!0;if(this.options.documentNode.queryCommandSupported&&this.options.documentNode.queryCommandSupported("copy")){var e=this.options.documentNode.createElement("textarea");e.textContent=t,e.style.position="fixed",this.options.documentNode.body.appendChild(e),e.select();try{return this.options.documentNode.execCommand("copy")}catch(t){return!1}finally{this.options.documentNode.body.removeChild(e)}}return!1}},{key:"isScrolledIntoView",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t.getBoundingClientRect();return!e&&r.top>=0&&r.top<=this.options.windowNode.innerHeight||e&&r.top>=0&&r.bottom<=this.options.windowNode.innerHeight}},{key:"scrollToElement",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"smooth",a=!0===this.options.windowNode.matchMedia("(prefers-reduced-motion: reduce)")||!0===this.options.windowNode.matchMedia("(prefers-reduced-motion: reduce)").matches;return this.options.windowNode.scrollTo({top:t.getBoundingClientRect().top-Number(e),behavior:a?"instant":r}),this}},{key:"objectToQueryParam",value:function(t){var e=[],r=function(t,r){r=null==(r="function"==typeof r?r():r)?"":r,e[e.length]=encodeURIComponent(t)+"="+encodeURIComponent(r)};return function t(a,i){var n,o,s;if(a)if(Array.isArray(i))for(n=0,o=i.length;n<o;n++)t(a+"["+("object"===_typeof(i[n])&&i[n]?n:"")+"]",i[n]);else if("[object Object]"===Object.prototype.toString.call(i))for(s in i)t(a+"["+s+"]",i[s]);else r(a,i);else if(Array.isArray(i))for(n=0,o=i.length;n<o;n++)r(i[n].name,i[n].value);else for(s in i)t(s,i[s]);return e}("",t).join("&")}},{key:"extendObject",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return Object.assign.apply(Object,[{}].concat(e))}}]),t}();export default WCPW;