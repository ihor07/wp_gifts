function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}!function(t,e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module&&"function"==typeof require?module.exports=e(require("jquery")):e(t.jQuery)}(this,(function(t){"use strict";var e="wcpwSteps",a={},n=t(document),o=function(e,n){return this.element=e,this.options=t.extend({},a,n),this.init()};o.prototype.init=function(){return this.$element=t(this.element),this.$list=this.$element.find('[data-component~="wcpw-steps-list"]'),this.$modal=t('[data-component~="wcpw-step-modal"]'),this.$modalBody=this.$modal.find('[data-component~="wcpw-step-modal-body"]'),this.ajaxUrl=this.element.getAttribute("data-ajax-url"),t.fn.sortable&&this.$list.sortable({items:'[data-component~="wcpw-steps-list-item"]',distance:50}),this},o.prototype.addItem=function(){var t=this.$list.children(),e=0;t.length&&t.each((function(){e=Math.max(e,Number(this.getAttribute("data-id")))})),e++;var a=this.$element.find('[data-component~="wcpw-steps-list-item-template"]').clone().appendTo(this.$list).attr("data-component","wcpw-steps-list-item").attr("data-id",e),n=a.find('[data-component~="wcpw-steps-list-item-settings"]'),o=a.find('[data-component~="wcpw-steps-list-item-clone"]');return a.find('[data-component~="wcpw-steps-list-item-name"]').text("#".concat(e)).end().find('[data-component~="wcpw-steps-list-item-id"]').attr("name","_steps_ids[".concat(e,"]")).attr("value",e),n.attr("data-settings",n.attr("data-settings").replace(/%STEP_ID%/g,e)),o.attr("data-settings",o.attr("data-settings").replace(/%STEP_ID%/g,e)),this.$element.trigger("added.item.steps.wcpw",[this,o]),a},o.prototype.showModal=function(){return this.$modal.addClass("is-opened"),this},o.prototype.hideModal=function(){return this.$modal.removeClass("is-opened"),this},o.prototype.getSettings=function(e){var a=this,n=t.extend({},{action:"wcpwGetStepSettingsForm"},e);return t.get(this.ajaxUrl,n,(function(e){a.$modalBody.html(e),a.$modalBody.find('[data-component~="wcpw-data-table"][data-key="filters"] [data-component="wcpw-data-table-body-item"][data-key="label"] input').each((function(){if(this.value){var e=t(this);e.closest('[data-component="wcpw-data-table-item"]').find('[data-component="wcpw-data-table-item-open-modal"]').attr("data-name",e.val())}})),a.showModal(),a.$element.trigger("get.settings.item.steps.wcpw",[a,e])}))},o.prototype.saveSettings=function(e){var a=e.find("#title").val(),n=e.find("#notes").val(),o=e.attr("data-step-id"),i={action:"wcpwSaveStepSettings",post_id:e.attr("data-post-id"),step_id:o,values:e.serialize()};return this.$list.find('[data-component="wcpw-steps-list-item"][data-id="'.concat(o,'"] ')+'[data-component="wcpw-steps-list-item-name"]').html("#".concat(o," ").concat(a)+(n?" <small>(".concat(n,")</small>"):"")),t.post(this.ajaxUrl,i,null,"json")},o.prototype.cloneItem=function(e,a,n){var o={action:"wcpwCloneStepSettings",post_id:e,source_step:a,target_step:n};return t.post(this.ajaxUrl,o,null,"json")},o.prototype.removeItem=function(t){return t.remove(),this.$element.trigger("removed.item.steps.wcpw",[this]),this},o.prototype.checkFromValidity=function(t){var e=!0;return 0===t.length||t.each((function(){"undefined"!==this.checkValidity&&(e=this.checkValidity())})),e},t.fn[e]=function(a){return this.each((function(){t.data(this,e)||t.data(this,e,new o(this,a))}))};var i=function(){return t('[data-component~="wcpw-steps"]').each((function(){return t(this).wcpwSteps()}))};n.ready((function(){return i()})),n.on("init.steps.wcpw",(function(){return i()})),n.on("click",'[data-component~="wcpw-steps-add"]',(function(a){a.preventDefault();var n=t(this).closest('[data-component~="wcpw-steps"]');return n.data(e)?n.data(e).addItem():this})),n.on("click",'[data-component~="wcpw-steps-list-item-remove"]',(function(a){a.preventDefault();var n=t(this),o=n.closest('[data-component~="wcpw-steps"]');return o.data(e)?o.data(e).removeItem(n.closest('[data-component~="wcpw-steps-list-item"]')):this})),n.on("click",'[data-component~="wcpw-steps-list-item-settings"]',(function(a){a.preventDefault();var n=t(this),o=n.closest('[data-component~="wcpw-steps"]');return n.addClass("is-loading"),o.data(e)?o.data(e).getSettings(n.data("settings")).always((function(){return n.removeClass("is-loading")})):this})),n.on("click",'[data-component~="wcpw-steps-list-item-clone"]',(function(a){a.preventDefault();var n=t(this),o=n.closest('[data-component~="wcpw-steps"]');if(n.addClass("is-loading"),o.data(e)){var i=o.data(e).addItem();return o.data(e).cloneItem(n.data("settings").post_id,n.data("settings").step_id,i.data("id")).always((function(){return n.removeClass("is-loading")}))}return this})),n.on("submit",'[data-component~="wcpw-step-settings-form"]',(function(a){var n=t(this),o=t('[data-component~="wcpw-steps"]');if(o.data(e)){if(!o.data(e).checkFromValidity(n))return n.find('[data-component~="wcpw-settings-group-content"]').attr("aria-expanded","true"),this;a.preventDefault(),o.data(e).hideModal().saveSettings(n)}return this})),n.on("click",'[data-component~="wcpw-step-modal-close"]',(function(a){a.preventDefault();var n=t('[data-component~="wcpw-steps"]');return n.data(e)&&n.data(e).hideModal(),this})),n.on("change",'[data-component~="wcpw-step-settings-form"] #item_template',(function(){var e=t(this),a=e.next('[data-component="wcpw-form-item-template-preview"]');a.html('<img alt="" src="'.concat(a.data("src")).concat(e.val(),'.png">'))})),n.on("change",'[data-component~="wcpw-step-setting-apply-to-all-input"]',(function(){var e=t(this);e.closest('[data-component~="wcpw-step-setting-apply-to-all-label"]')[e.is(":checked")?"addClass":"removeClass"]("is-active")})),n.on("change",'[data-component~="wcpw-data-table"][data-key="filters"] [data-component="wcpw-data-table-body-item"][data-key="label"] input',(function(){if(this.value){var e=t(this);e.closest('[data-component="wcpw-data-table-item"]').find('[data-component="wcpw-data-table-item-open-modal"]').attr("data-name",e.val())}}))}));