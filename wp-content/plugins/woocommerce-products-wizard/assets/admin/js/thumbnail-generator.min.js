function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}!function(t,e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module&&"function"==typeof require?module.exports=e(require("jquery")):e(t.jQuery)}(this,(function(t){"use strict";var e="wcpwThumbnailGenerator",n={},a=t(document),i=function(e,a){return this.element=e,this.options=t.extend({},n,a),this.init()};i.prototype.init=function(){return this.$element=t(this.element),this.$areasCount=this.$element.find('[data-component~="wcpw-thumbnail-generator-areas-count"]'),this.$areaSelect=this.$element.find('[data-component~="wcpw-thumbnail-generator-area-select"]'),this.$canvas=this.$element.find('[data-component~="wcpw-thumbnail-generator-canvas"]'),this.ajaxUrl=this.$canvas.data("ajax-url")||"/wp-admin/admin-ajax.php",this.canvasSize={width:this.$canvas.width(),height:this.$canvas.height()},this.resizableSettings={containment:'[data-component~="wcpw-thumbnail-generator-canvas"]',snap:!0,snapTolerance:10,handles:"all",resize:function(e,n){var a=t(this).closest('[data-component~="wcpw-thumbnail-generator-area"]');a.find('[data-component~="wcpw-thumbnail-generator-area-width"]').val(n.size.width),a.find('[data-component~="wcpw-thumbnail-generator-area-height"]').val(n.size.height),e.preventDefault()}},this.draggableSettings={containment:'[data-component~="wcpw-thumbnail-generator-canvas"]',snap:!0,snapTolerance:10,drag:function(e,n){var a=t(this).closest('[data-component~="wcpw-thumbnail-generator-area"]');a.find('[data-component~="wcpw-thumbnail-generator-area-y"]').val(n.position.top),a.find('[data-component~="wcpw-thumbnail-generator-area-x"]').val(n.position.left)}},this.initEventListeners().initUIHelpers()},i.prototype.initEventListeners=function(){var e=this,n=this;return this.$element.on("change","#_thumbnail_canvas_width",(function(){return n.setCanvasSize({width:this.value})})),this.$element.on("change","#_thumbnail_canvas_height",(function(){return n.setCanvasSize({height:this.value})})),this.$element.on("click",'[data-component~="wcpw-thumbnail-generator-clear"]',(function(t){return t.preventDefault(),e.clearCanvas()})),this.$element.on("click",'[data-component~="wcpw-thumbnail-generator-area-add"]',(function(t){return t.preventDefault(),e.addArea()})),this.$element.on("click",'[data-component~="wcpw-thumbnail-generator-area-settings-modal-open"]',(function(t){t.preventDefault(),n.$element.find(this.getAttribute("href")).addClass("is-opened")})),this.$element.on("click",'[data-component~="wcpw-thumbnail-generator-area-settings-modal-close"]',(function(e){e.preventDefault(),t(this).closest('[data-component~="wcpw-thumbnail-generator-area-settings-modal"]').removeClass("is-opened")})),this.$element.on("click",'[data-component~="wcpw-thumbnail-generator-area-clone"]',(function(){return n.cloneArea(t(this).closest('[data-component~="wcpw-thumbnail-generator-area"]'))})),this.$element.on("click",'[data-component~="wcpw-thumbnail-generator-area-remove"]',(function(){return n.removeArea(t(this).closest('[data-component~="wcpw-thumbnail-generator-area"]'))})),this.$element.on("change",'[data-component~="wcpw-thumbnail-generator-area-x"]',(function(){var e=t(this),a=e.closest('[data-component~="wcpw-thumbnail-generator-area"]').find('[data-component~="wcpw-thumbnail-generator-area-inner"]'),i=Number(e.val());return i+a.width()>n.canvasSize.width&&(i=n.canvasSize.width-a.width(),setTimeout((function(){return e.val(i)}),0)),n.setAreaProperty(a,{left:i})})),this.$element.on("change",'[data-component~="wcpw-thumbnail-generator-area-y"]',(function(){var e=t(this),a=e.closest('[data-component~="wcpw-thumbnail-generator-area"]').find('[data-component~="wcpw-thumbnail-generator-area-inner"]'),i=Number(e.val());return i+a.height()>n.canvasSize.height&&(i=n.canvasSize.height-a.height(),setTimeout((function(){return e.val(i)}),0)),n.setAreaProperty(a,{top:i})})),this.$element.on("change",'[data-component~="wcpw-thumbnail-generator-area-width"]',(function(){var e=t(this),a=e.closest('[data-component~="wcpw-thumbnail-generator-area"]').find('[data-component~="wcpw-thumbnail-generator-area-inner"]'),i=Number(e.val());return i+a.position().left>n.canvasSize.width&&(i=n.canvasSize.width-a.position().left,setTimeout((function(){return e.val(i)}),0)),n.setAreaProperty(a,{width:i})})),this.$element.on("change",'[data-component~="wcpw-thumbnail-generator-area-height"]',(function(){var e=t(this),a=e.closest('[data-component~="wcpw-thumbnail-generator-area"]').find('[data-component~="wcpw-thumbnail-generator-area-inner"]'),i=Number(e.val());return i+a.position().top>n.canvasSize.height&&(i=n.canvasSize.height-a.position().top,setTimeout((function(){return e.val(i)}),0)),n.setAreaProperty(a,{height:i})})),this.$element.on("click",'[data-component~="wcpw-thumbnail-generator-area-move"]',(function(e){e.preventDefault();var a=t(this),i=a.closest('[data-component~="wcpw-thumbnail-generator-area"]');return n.changeAreaOrder(i,a.data("direction"))})),this.$element.on("click",'[data-component~="wcpw-thumbnail-generator-area-settings-modal-select"]',(function(e){e.preventDefault();var a=t(this),i=a.closest('[data-component~="wcpw-thumbnail-generator-area"]');if(i.is(":only-child"))return this;var r=null;return r="next"===a.data("direction")?i.is(":last-child")?i.parent().find('[data-component="wcpw-thumbnail-generator-area"]:first-child'):i.next():i.is(":first-child")?i.parent().find('[data-component="wcpw-thumbnail-generator-area"]:last-child'):i.prev(),n.$element.find('[data-component~="wcpw-thumbnail-generator-area-settings-modal"]').removeClass("is-opened"),r.find('[data-component~="wcpw-thumbnail-generator-area-settings-modal"]').addClass("is-opened"),this})),this},i.prototype.initUIHelpers=function(){var e=this.$element.find('[data-component~="wcpw-thumbnail-generator-area-inner"]');return t.fn.draggable&&e.draggable(this.draggableSettings),t.fn.resizable&&e.resizable(this.resizableSettings),this},i.prototype.recalculateIds=function(){return this.$canvas.find('[data-component~="wcpw-thumbnail-generator-area"]').each((function(e){var n=t(this);return n.find('[data-component~="wcpw-thumbnail-generator-area-index"]').val(e),n.find(":input").each((function(){var n=t(this).attr("name");return n?t(this).attr("name",n.replace(/\[\d+]/g,"[".concat(e,"]"))):this}))})),this},i.prototype.setCanvasSize=function(t){var e={};return void 0!==t.width&&(this.canvasSize.width=t.width,e.width=t.width+"px"),void 0!==t.height&&(this.canvasSize.height=t.height,e.height=t.height+"px"),this.$canvas.css(e),this},i.prototype.clearCanvas=function(){return this.$canvas.html(""),this.recalculateAreasCount()},i.prototype.addArea=function(){var e=this,n={action:"wcpwGetThumbnailGeneratorAreaView",id:this.$areaSelect.val(),type:this.$areaSelect.find(":selected").parent().data("type"),index:this.$canvas.find('[data-component~="wcpw-thumbnail-generator-area"]').length};return t.post(this.ajaxUrl,n,(function(t){e.$canvas.append(t.html),e.recalculateAreasCount().recalculateIds().initUIHelpers(),e.$element.trigger("added.area.thumbnailGenerator.wcpw",[e,t])}),"json")},i.prototype.cloneArea=function(t){var e=t.clone(),n=e.find('[data-component~="wcpw-thumbnail-generator-area-settings-modal"]'),a=e.find('[data-component~="wcpw-thumbnail-generator-area-settings-modal-open"]'),i=~~(1e6*Math.random());return n.attr("id","wcpw-thumbnail-generator-area-settings-modal-".concat(i.toString())),a.attr("href","#wcpw-thumbnail-generator-area-settings-modal-".concat(i.toString())),e.find(".ui-resizable-handle").remove(),e.insertAfter(t),t.find('[data-component~="wcpw-thumbnail-generator-area-settings-modal"]').removeClass("is-opened"),this.recalculateAreasCount().recalculateIds().initUIHelpers(),this.$element.trigger("cloned.area.thumbnailGenerator.wcpw",[this,e]),this},i.prototype.removeArea=function(t){return t.remove(),this.recalculateAreasCount().recalculateIds(),this.$element.trigger("removed.area.thumbnailGenerator.wcpw",[this]),this},i.prototype.setAreaProperty=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a={},i=t.height(),r=t.width(),o=t.position();return void 0!==e.top&&(n||e.top+i<=this.canvasSize.height&&!n)&&(a.top=e.top+"px"),void 0!==e.left&&(n||e.left+r<=this.canvasSize.width&&!n)&&(a.left=e.left+"px"),void 0!==e.width&&(n||e.width+o.left<=this.canvasSize.width&&!n)&&(a.width=e.width+"px"),void 0!==e.height&&(n||e.height+o.top<=this.canvasSize.height&&!n)&&(a.height=e.height+"px"),t.css(a),this},i.prototype.changeAreaOrder=function(t,e){switch(e){default:case"up":t.prev().length>0&&t.prev().insertAfter(t);break;case"down":t.next().length>0&&t.next().insertBefore(t)}return this.recalculateIds()},i.prototype.recalculateAreasCount=function(){return this.$areasCount.text(this.$canvas.find('[data-component~="wcpw-thumbnail-generator-area"]').length),this},t.fn[e]=function(n){return this.each((function(){t.data(this,e)||t.data(this,e,new i(this,n))}))};var r=function(){return t('[data-component~="wcpw-thumbnail-generator-canvas"]').each((function(){return t(this).closest('[data-component~="wcpw-settings-group-content"]').wcpwThumbnailGenerator()}))};a.ready((function(){return r()})),a.on("init.thumbnailGenerator.wcpw",(function(){return r()}))}));